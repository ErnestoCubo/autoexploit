New-Module -Name PrivScript -ScriptBlock {

    function privScanner {
        checkLocalAdmin
        unquotedPath

    }

    function checkLocalAdmin {
        #Check para ver si el usuario actual se encuentra el grupo de administradores
        Write-Host "`n[*]Checking for local administrators . . .`n" -ForegroundColor Yellow
        Start-Sleep 3
        $actualUser = whoami.exe
        $localAdmins = Get-LocalGroupMember -Name "Administradores" | Select-Object -ExpandProperty Name
        
        if ($localAdmins -Contains $actualUSer) {
            Write-Host "You are local administrator" -ForegroundColor Green
        }
        else {
            Write-Host "You are not in the local admins group local admins:`n" -ForegroundColor Red
            foreach ($admin in $localAdmins) {
                Write-Host $admin  -ForegroundColor Green
            }
                    
        }
    }
    function unquotedPath {
        #Funci√≥n que busca vulnerabilidades en los Paths del sistema
        Write-Host "`n[*]Checking for unquoted paths. . .`n" -ForegroundColor Yellow
        Start-Sleep 3
        $unquotedPaths = Get-WmiObject -Class Win32_Service | Where-Object { $_.StartMode -eq "Auto" -and !$_.PathName.contains("C:\WINDOWS") } | Select-Object -Property Name, DisplayName, PathName, StartMode
        foreach ($unquotedPath in $unquotedPaths) {
            if ($unquotedPath.Pathname -notmatch '"') {
                Write-Host $unquotedPath.Pathname -ForegroundColor Green
               
            }
            else {
                Write-Host "No unquoted paths were found" -ForegroundColor Red
            }
            
        }
        
    }

}

Export-ModuleMember -Function privScanner

